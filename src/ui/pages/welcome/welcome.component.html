<div class="main-content">
    <app-header>
        <h2>¡Bienvenido, usuario!</h2>
    </app-header>
    <div class="main">
        @if (!stepOne) {
        <h3>Nos alegra tenerte aquí. Antes de empezar, configura tu perfil para que otros usuarios puedan conocerte
            mejor</h3>

        <div class="btn">
            <app-button buttonClass="medium-button" text="Configurar mi perfil" (click)="changeStep()" />
        </div>
        }@else {
        <form [formGroup]="formDescription">
            <textarea formControlName="about_me"></textarea>
            <div class="teach">
                <p>Lo que puedo enseñar:</p>
                <app-button buttonClass="medium-button" text="Elegir tema" (click)="showDialog(0, 'know')" />
                <div class="topics-teach">
                    @for (item of getUserPreferences('know'); track item.getIndex()) {
                    <!-- Checar lo del tagRemove -->
                    <p-chip [label]="item.getTopicName()" [removable]="true"
                        (onRemove)="deleteUserPreference(item.getTopicName())" />
                    }
                </div>
            </div>

            <div class="learn">
                Lo que quiero aprender:
                <app-button buttonClass="medium-button" text="Elegir tema" (click)="showDialog(1, 'learn')" />
                <div class="topics-learn">
                    @for (item of getUserPreferences('learn'); track item.getIndex()) {
                    <!-- Checar lo del tagRemove -->
                    <p-chip [label]="item.getTopicName()" [removable]="true"
                        (onRemove)="deleteUserPreference(item.getTopicName())" />
                    }
                </div>
            </div>
        </form>
        }
    </div>
</div>
<app-aside>
    @if (stepOne) {
    <div class="header">

    </div>
    <div class="formulario-final">
        <div class="foto-perfil text-center mb-5">
            <p class="text-center">Foto de perfil</p>
            <p-avatar *ngIf="!uploadedImage" icon="pi pi-image" styleClass="mr-5" size="xlarge" shape="circle"
                class="text-center"></p-avatar>
            <div *ngIf="uploadedImage" class="text-center" class="image-container text-center">
                <img [src]="uploadedImage" alt="" class="profile-image">
            </div>

            <p-fileUpload mode="basic" [multiple]="true" name="demo[]" chooseIcon="pi pi-upload" accept="image/*"
                maxFileSize="1000000" [auto]="true" chooseLabel="Subir imagen" (onSelect)="onImageUpload($event)" />
            <button *ngIf="uploadedImage" (click)="removeImage()">Eliminar imagen</button>
        </div>
        <div class="btnSend">
            <app-button buttonClass="medium-button" text="Guardar perfil" (click)="uploadInformation()"></app-button>
        </div>
    </div>
    }
</app-aside>
<p-dialog [modal]="true" [(visible)]="visible" [style]="{ width: '40rem', height:'40rem' }" [closable]="false"
    [dismissableMask]="true" [draggable]="false">
    <form [formGroup]="formTopics">
        <div class="flex justify-content-center">
            <p-stepper [linear]="true" [activeStep]="activeStep()">
                <p-stepperPanel>
                    <ng-template pTemplate="content">
                        <div class="container">
                            <div class="title">
                                <h2>Selecciona una categoría principal</h2>
                            </div>
                            <div>

                                <!--PREGUNTAR PROFE PARA PARPADEAR PANTALLA-->
                                @if(responseTopicPrincipal$ | async; as topicPrincipalList ){
                                @defer() {
                                <p-dropdown optionLabel="name" placeholder="Seleccionar categoria"
                                    [style]='{width:"100%"}' [options]="topicPrincipalList" optionLabel="topic_name"
                                    formControlName="firstTopic" />
                                }
                                }

                            </div>
                        </div>
                        <div class="mt-3">
                            <app-button buttonClass="medium-button" text="Siguiente" (clickEvent)="next()" />
                        </div>
                    </ng-template>
                </p-stepperPanel>
                <p-stepperPanel>
                    <ng-template pTemplate="content">
                        <div class="container text-center">
                            <h2>Selecciona un subtema dentro de </h2>
                        </div>
                        <div>
                            <p-dropdown optionLabel="name" placeholder="Seleccionar categoria" [style]='{width:"100%"}'
                                [options]="getTopicTags().getTopicSecondList()" optionLabel="topic_name"
                                formControlName="secondTopic" />
                        </div>
                        <div class="mt-3">
                            <app-button buttonClass="medium-button" text="Siguiente" (clickEvent)="next()" />
                        </div>
                    </ng-template>
                </p-stepperPanel>
                <p-stepperPanel>
                    <ng-template pTemplate="content">
                        <div class="container text-center">
                            <h2>Personaliza tu selección con palabras clave</h2>
                        </div>

                        <div class="input-group text-center">
                            <p-autoComplete [suggestions]="filteredTags" optionLabel="tag_name"
                                (completeMethod)="filterTags($event)" formControlName="tag"
                                [showEmptyMessage]="false" />



                            <app-button buttonClass="medium-button" text="Añadir" (clickEvent)="addTag()"></app-button>
                        </div>

                        <div class="flex align-items-center gap-2 flex-wrap">
                            @for (item of getTopicTags().getTagAdded(); track item.getId()) {
                            <p-chip [label]="item.getTagName()" [removable]="true"
                                (onRemove)="getTopicTags().tagRemove(item.getId())" />
                            }
                        </div>

                        <div class="mt-3">
                            <app-button buttonClass="medium-button" text="Siguiente" (clickEvent)="next()" />
                        </div>
                    </ng-template>
                </p-stepperPanel>
            </p-stepper>
        </div>
    </form>
</p-dialog>