<div class="main-content">
    <app-header>
        <h2>¡Bienvenido a TalkZone!</h2>
    </app-header>
    <div class="main">
        @if (!stepOne) {
            <div class="containerr">
                <div class="intro">
                  <p>En <strong>TalkZone</strong>, puedes aprender, enseñar y conectar con personas que comparten tus intereses. Hemos creado una experiencia flexible para que explores temas, compartas conocimientos y participes en conversaciones enriquecedoras.</p>
                </div>
            
                <div class="roles">
                  <div class="role">
                    <h2>Exploradores</h2>
                    <p>Si deseas aprender, selecciona los temas que te interesan y comienza a descubrir nuevas ideas.</p>
                  </div>
            
                  <div class="role">
                    <h2>Mentores</h2>
                    <p>Si eres experto en algún tema, comparte tu conocimiento con los demás y ayuda a los Exploradores a crecer.</p>
                  </div>
            
                  <div class="role">
                    <h2>Entusiastas</h2>
                    <p>Si te apasiona participar en conversaciones, pero no te enfocas en enseñar ni aprender formalmente, este rol es para ti.</p>
                  </div>
                </div>
            
                <div class="footer">
                  <p>¡Elige tus temas y conecta con otros! Puedes cambiar de rol y explorar lo que más te interese. ¡Disfruta de la experiencia en TalkZone!</p>
                </div>
              </div>
        <div class="btn">
            <app-button buttonClass="medium-button" text="Configurar mi perfil" (click)="changeStep()" />
        </div>
        }@else {
        <form [formGroup]="formDescription">
            <textarea formControlName="about_me"></textarea>
            <div class="teach">
                <p>Explorador:</p>
                <app-button buttonClass="medium-button" text="Elegir tema" (click)="showDialog(0, 'explorador')" />
                <div class="topics-teach">
                    @for (item of getUserPreferences('explorador'); track item) {
                    <!-- Checar lo del tagRemove -->
                    <p-chip [label]="item.getTopicName()" [removable]="true"
                        (onRemove)="deleteUserPreference(item.getTopicName())" />
                    }
                </div>
            </div>

            <div class="learn">
                Mentor:
                <app-button buttonClass="medium-button" text="Elegir tema" (click)="showDialog(1, 'mentor')" />
                <div class="topics-learn">
                    @for (item of getUserPreferences('mentor'); track item) {
                    <!-- Checar lo del tagRemove -->
                    <p-chip [label]="item.getTopicName()" [removable]="true"
                        (onRemove)="deleteUserPreference(item.getTopicName())" />
                    }
                </div>
            </div>

            <div class="learn">
                Entusiasta:
                <app-button buttonClass="medium-button" text="Elegir tema" (click)="showDialog(1, 'entusiasta')" />
                <div class="topics-learn">
                    @for (item of getUserPreferences('entusiasta'); track item) {
                    <!-- Checar lo del tagRemove -->
                    <p-chip [label]="item.getTopicName()" [removable]="true"
                        (onRemove)="deleteUserPreference(item.getTopicName())" />
                    }
                </div>
            </div>
        </form>
        }
    </div>
</div>
<app-aside>
    @if (stepOne) {
    <div class="header">

    </div>
    <div class="formulario-final">
        <div class="foto-perfil text-center mb-5">
            <p class="text-center">Foto de perfil</p>
            <p-avatar *ngIf="!uploadedImage" icon="pi pi-image" styleClass="mr-5" size="xlarge" shape="circle"
                class="text-center"></p-avatar>
            <div *ngIf="uploadedImage" class="text-center" class="image-container text-center">
                <img [src]="uploadedImage" alt="" class="profile-image">
            </div>

            <p-fileUpload mode="basic" [multiple]="true" name="demo[]" chooseIcon="pi pi-upload" accept="image/*"
                maxFileSize="1000000" [auto]="true" chooseLabel="Subir imagen" (onSelect)="onImageUpload($event)" />
            <button *ngIf="uploadedImage" (click)="removeImage()">Eliminar imagen</button>
        </div>
        <div class="btnSend">
            <app-button buttonClass="medium-button" text="Guardar perfil" (click)="uploadInformation()"></app-button>
        </div>
    </div>
    }
</app-aside>
<p-dialog [modal]="true" [(visible)]="visible" [style]="{ width: '40rem', height:'40rem' }" [closable]="false"
    [dismissableMask]="true" [draggable]="false">
    <form [formGroup]="formTopics">
        <div class="flex justify-content-center">
            <p-stepper [linear]="true" [activeStep]="activeStep()">
                <p-stepperPanel>
                    <ng-template pTemplate="content">
                        <div class="container">
                            <div class="title">
                                <h2>Selecciona una categoría principal</h2>
                            </div>
                            <div>

                                <!--PREGUNTAR PROFE PARA PARPADEAR PANTALLA-->
                                @if(responseTopicPrincipal$ | async; as topicPrincipalList ){
                                @defer() {
                                <p-dropdown optionLabel="name" placeholder="Seleccionar categoria"
                                    [style]='{width:"100%"}' [options]="topicPrincipalList" optionLabel="topic_name"
                                    formControlName="firstTopic" />
                                }
                                }

                            </div>
                        </div>
                        <div class="mt-3">
                            <app-button buttonClass="medium-button" text="Siguiente" (clickEvent)="next()" />
                        </div>
                    </ng-template>
                </p-stepperPanel>
                <p-stepperPanel>
                    <ng-template pTemplate="content">
                        <div class="container text-center">
                            <h2>Selecciona un subtema dentro de </h2>
                        </div>
                        <div>
                            <p-dropdown optionLabel="name" placeholder="Seleccionar categoria" [style]='{width:"100%"}'
                                [options]="getTopicTags().getTopicSecondList()" optionLabel="topic_name"
                                formControlName="secondTopic" />
                        </div>
                        <div class="mt-3">
                            <app-button buttonClass="medium-button" text="Siguiente" (clickEvent)="next()" />
                        </div>

                        @if (topicExiste()) {
                            <h3>Ese tema, ya esta puesto en alguna de tus otras preferencias, por favor, elige otro :D</h3>
                        }
                    </ng-template>
                </p-stepperPanel>
                <p-stepperPanel>
                    <ng-template pTemplate="content">
                        <div class="container text-center">
                            <h2>Personaliza tu selección con palabras clave</h2>
                        </div>

                        <div class="input-group text-center">
                            <p-autoComplete [suggestions]="filteredTags" optionLabel="tag_name"
                                (completeMethod)="filterTags($event)" formControlName="tag"
                                [showEmptyMessage]="false" />



                            <app-button buttonClass="medium-button" text="Añadir" (clickEvent)="addTag()"></app-button>
                        </div>

                        <div class="flex align-items-center gap-2 flex-wrap">
                            @for (item of getTopicTags().getTagAdded(); track item.getId()) {
                            <p-chip [label]="item.getTagName()" [removable]="true"
                                (onRemove)="getTopicTags().tagRemove(item.getId())" />
                            }
                        </div>

                        <div class="mt-3">
                            <app-button buttonClass="medium-button" text="Siguiente" (clickEvent)="next()" />
                        </div>
                    </ng-template>
                </p-stepperPanel>
            </p-stepper>
        </div>
    </form>
</p-dialog>